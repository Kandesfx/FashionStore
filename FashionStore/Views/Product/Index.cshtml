@{
    ViewBag.Title = "Sản phẩm";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .product-list-section {
        padding: 60px 0;
        background: #f8f9fa;
    }

    .breadcrumb-custom {
        background: transparent;
        padding: 0;
        margin-bottom: 30px;
        font-size: 14px;
    }

    .breadcrumb-custom a {
        color: #666;
        text-decoration: none;
        transition: color 0.3s ease;
    }

    .breadcrumb-custom a:hover {
        color: #c9a063;
    }

    .breadcrumb-custom .active {
        color: #1a1a1a;
    }

    /* Page Header */
    .page-header {
        background: white;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .page-title {
        font-family: 'Playfair Display', serif;
        font-size: 36px;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 10px;
    }

    .page-subtitle {
        color: #666;
        font-size: 16px;
        margin: 0;
    }

    /* Sidebar */
    .sidebar {
        position: sticky;
        top: 100px;
    }

    .filter-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .filter-title {
        font-family: 'Playfair Display', serif;
        font-size: 20px;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }

    .category-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .category-item {
        margin-bottom: 10px;
    }

    .category-link {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 15px;
        color: #666;
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-size: 15px;
    }

    .category-link:hover {
        background: #f8f9fa;
        color: #c9a063;
        padding-left: 20px;
    }

    .category-link.active {
        background: linear-gradient(135deg, #c9a063, #d4b072);
        color: white;
        font-weight: 600;
    }

    .category-link.active:hover {
        padding-left: 15px;
    }

    .category-icon {
        width: 8px;
        height: 8px;
        background: currentColor;
        border-radius: 50%;
        margin-right: 10px;
    }

    .sort-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .sort-link {
        display: flex;
        align-items: center;
        padding: 12px 15px;
        color: #666;
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-size: 15px;
        border: 2px solid transparent;
    }

    .sort-link:hover {
        background: #f8f9fa;
        color: #c9a063;
    }

    .sort-link.active {
        background: white;
        color: #c9a063;
        border-color: #c9a063;
        font-weight: 600;
    }

    .sort-link i {
        margin-right: 10px;
        width: 20px;
    }

    /* Products Grid */
    .products-container {
        background: transparent;
    }

    .products-header {
        background: white;
        padding: 20px 25px;
        border-radius: 15px;
        margin-bottom: 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .products-count {
        color: #666;
        font-size: 15px;
    }

    .products-count strong {
        color: #1a1a1a;
        font-weight: 600;
    }

    .view-toggle {
        display: flex;
        gap: 10px;
    }

    .view-btn {
        width: 40px;
        height: 40px;
        border: 2px solid #e5e5e5;
        background: white;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        color: #666;
    }

    .view-btn:hover,
    .view-btn.active {
        border-color: #c9a063;
        background: #c9a063;
        color: white;
    }

    /* Product Card */
    .product-card {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
        margin-bottom: 30px;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .product-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }

    .product-image-wrapper {
        position: relative;
        overflow: hidden;
        height: 320px;
        background: #f8f9fa;
    }

    .product-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform, opacity;
    }

    .product-image-hover {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        opacity: 0;
        transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: opacity;
    }

    .product-card:hover .product-image {
        transform: scale(1.1);
    }

    .product-card:hover .product-image-hover {
        opacity: 1;
    }

    .product-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: #e74c3c;
        color: white;
        padding: 6px 15px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        z-index: 1;
    }

    .product-actions {
        position: absolute;
        top: 15px;
        left: 15px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        opacity: 0;
        transform: translateX(-20px);
        transition: all 0.3s ease;
    }

    .product-card:hover .product-actions {
        opacity: 1;
        transform: translateX(0);
    }

    .action-btn {
        width: 40px;
        height: 40px;
        background: white;
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .action-btn:hover {
        background: #c9a063;
        color: white;
        transform: scale(1.1);
    }

    .product-info {
        padding: 20px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .product-category {
        color: #999;
        font-size: 13px;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .product-name {
        font-family: 'Playfair Display', serif;
        font-size: 18px;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 12px;
        min-height: 50px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        line-height: 1.4;
    }

    .product-rating {
        margin-bottom: 12px;
    }

    .stars {
        color: #ffc107;
        font-size: 14px;
    }

    .product-price {
        margin-bottom: 15px;
        margin-top: auto;
    }

    .price-wrapper {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .price-original {
        text-decoration: line-through;
        color: #999;
        font-size: 15px;
    }

    .price-discount {
        color: #e74c3c;
        font-size: 22px;
        font-weight: 700;
    }

    .price-regular {
        color: #1a1a1a;
        font-size: 22px;
        font-weight: 700;
    }

    .product-footer {
        padding: 0 20px 20px;
    }

    .btn-view-detail {
        background: #1a1a1a;
        color: white;
        padding: 12px 25px;
        border-radius: 25px;
        text-decoration: none;
        display: block;
        text-align: center;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        border: 2px solid #1a1a1a;
    }

    .btn-view-detail:hover {
        background: #c9a063;
        border-color: #c9a063;
        color: white;
        transform: translateY(-2px);
    }

    /* Pagination */
    .pagination-wrapper {
        display: flex;
        justify-content: center;
        margin-top: 40px;
    }

    .pagination-custom {
        display: flex;
        gap: 10px;
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .page-item {
        margin: 0;
    }

    .page-link-custom {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 45px;
        height: 45px;
        background: white;
        border: 2px solid #e5e5e5;
        border-radius: 10px;
        color: #666;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .page-link-custom:hover {
        border-color: #c9a063;
        color: #c9a063;
        transform: translateY(-3px);
    }

    .page-item.active .page-link-custom {
        background: linear-gradient(135deg, #c9a063, #d4b072);
        border-color: #c9a063;
        color: white;
    }

    /* Empty State */
    .empty-state {
        background: white;
        border-radius: 15px;
        padding: 60px 30px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .empty-icon {
        font-size: 80px;
        color: #e5e5e5;
        margin-bottom: 20px;
    }

    .empty-title {
        font-family: 'Playfair Display', serif;
        font-size: 24px;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 10px;
    }

    .empty-text {
        color: #666;
        font-size: 16px;
        margin-bottom: 25px;
    }

    .btn-browse {
        background: #c9a063;
        color: white;
        padding: 12px 35px;
        border-radius: 25px;
        text-decoration: none;
        display: inline-block;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn-browse:hover {
        background: #1a1a1a;
        color: white;
        transform: translateY(-3px);
    }

    /* Mobile Sidebar Toggle */
    .filter-toggle {
        display: none;
        background: white;
        border: 2px solid #c9a063;
        color: #c9a063;
        padding: 12px 25px;
        border-radius: 25px;
        font-weight: 600;
        margin-bottom: 20px;
        width: 100%;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .filter-toggle:hover {
        background: #c9a063;
        color: white;
    }

    /* Responsive */
    @@media (max-width: 991px) {
        .sidebar {
            position: fixed;
            top: 0;
            left: -100%;
            width: 300px;
            height: 100vh;
            background: white;
            z-index: 9999;
            overflow-y: auto;
            transition: left 0.3s ease;
            padding: 20px;
        }

        .sidebar.active {
            left: 0;
            box-shadow: 2px 0 20px rgba(0,0,0,0.2);
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 9998;
            display: none;
        }

        .sidebar-overlay.active {
            display: block;
        }

        .filter-toggle {
            display: block;
        }

        .sidebar-close {
            display: block;
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            background: #f0f0f0;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
        }

        .product-image-wrapper {
            height: 280px;
        }

        .page-title {
            font-size: 28px;
        }
    }

    @@media (max-width: 767px) {
        .products-header {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }

        .product-image-wrapper {
            height: 320px;
        }
    }
</style>

<div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

<section class="product-list-section">
    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb-custom">
            <a href="@Url.Action("Index", "Home")">Trang chủ</a>
            <span class="mx-2">/</span>
            <span class="active">Sản phẩm</span>
        </nav>

        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Khám Phá Sản Phẩm</h1>
            <p class="page-subtitle">Tìm kiếm những sản phẩm thời trang yêu thích của bạn</p>
        </div>

        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-3">
                <button class="filter-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-filter me-2"></i>
                    Bộ Lọc & Sắp Xếp
                </button>

                <div class="sidebar" id="sidebar">
                    <button class="sidebar-close d-lg-none" onclick="toggleSidebar()">
                        <i class="fas fa-times"></i>
                    </button>

                    <!-- Categories Filter -->
                    <div class="filter-card">
                        <h3 class="filter-title">
                            <i class="fas fa-th-large me-2" style="color: #c9a063;"></i>
                            Danh Mục
                        </h3>
                        <ul class="category-list">
                            <li class="category-item">
                                <a href="@Url.Action("Index", "Product")"
                                   class="category-link @(ViewBag.CurrentCategoryId == null ? "active" : "")">
                                    <span>
                                        <span class="category-icon"></span>
                                        Tất cả sản phẩm
                                    </span>
                                </a>
                            </li>
                            @if (ViewBag.Categories != null)
                            {
                                foreach (var category in ViewBag.Categories)
                                {
                                    <li class="category-item">
                                        <a href="@Url.Action("Index", "Product", new { categoryId = category.Id })"
                                           class="category-link @(ViewBag.CurrentCategoryId != null && (int)ViewBag.CurrentCategoryId == category.Id ? "active" : "")">
                                            <span>
                                                <span class="category-icon"></span>
                                                @category.CategoryName
                                            </span>
                                        </a>
                                    </li>
                                }
                            }
                        </ul>
                    </div>

                    <!-- Sort Filter -->
                    <div class="filter-card">
                        <h3 class="filter-title">
                            <i class="fas fa-sort-amount-down me-2" style="color: #c9a063;"></i>
                            Sắp Xếp
                        </h3>
                        <div class="sort-list">
                            <a href="@Url.Action("Index", "Product", new { categoryId = ViewBag.CurrentCategoryId, sortBy = "newest" })"
                               class="sort-link @(ViewBag.SortBy == null || ViewBag.SortBy == "newest" ? "active" : "")">
                                <i class="fas fa-clock"></i>
                                Mới nhất
                            </a>
                            <a href="@Url.Action("Index", "Product", new { categoryId = ViewBag.CurrentCategoryId, sortBy = "price-asc" })"
                               class="sort-link @(ViewBag.SortBy == "price-asc" ? "active" : "")">
                                <i class="fas fa-arrow-up"></i>
                                Giá tăng dần
                            </a>
                            <a href="@Url.Action("Index", "Product", new { categoryId = ViewBag.CurrentCategoryId, sortBy = "price-desc" })"
                               class="sort-link @(ViewBag.SortBy == "price-desc" ? "active" : "")">
                                <i class="fas fa-arrow-down"></i>
                                Giá giảm dần
                            </a>
                            <a href="@Url.Action("Index", "Product", new { categoryId = ViewBag.CurrentCategoryId, sortBy = "name-asc" })"
                               class="sort-link @(ViewBag.SortBy == "name-asc" ? "active" : "")">
                                <i class="fas fa-sort-alpha-down"></i>
                                Tên A-Z
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Grid -->
            <div class="col-lg-9">
                <div class="products-container">
                    @if (ViewBag.Products != null && ((System.Collections.IEnumerable)ViewBag.Products).Cast<object>().Any())
                    {
                        var productList = ((System.Collections.IEnumerable)ViewBag.Products).Cast<dynamic>().ToList();
                        var totalProducts = productList.Count();

                        <!-- Products Header -->
                        <div class="products-header">
                            <div class="products-count">
                                Hiển thị <strong>@totalProducts sản phẩm</strong>
                            </div>
                            <div class="view-toggle">
                                <button class="view-btn active" title="Grid View">
                                    <i class="fas fa-th"></i>
                                </button>
                                <button class="view-btn" title="List View">
                                    <i class="fas fa-list"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Products Grid -->
                        <div class="row">
                            @foreach (var product in productList)
                            {
                                <div class="col-lg-4 col-md-6">
                                    <div class="product-card">
                                        <div class="product-image-wrapper">
                                            @if (product.DiscountPrice != null && product.DiscountPrice > 0)
                                            {
                                                <span class="product-badge">
                                                    -@Math.Round((decimal)(((product.Price - product.DiscountPrice) / product.Price) * 100), 0)%
                                                </span>
                                            }
                                            <div class="product-actions">
                                                <button class="action-btn" title="Yêu thích">
                                                    <i class="far fa-heart"></i>
                                                </button>
                                                <button class="action-btn" title="Xem nhanh">
                                                    <i class="far fa-eye"></i>
                                                </button>
                                            </div>
                                            <img src="@product.ImageUrl" alt="@product.ProductName" class="product-image" 
                                                 data-original="@product.ImageUrl" 
                                                 data-detail1="@(product.Detail1 ?? product.ImageUrl)">
                                            @if (!string.IsNullOrEmpty(product.Detail1) && product.Detail1 != product.ImageUrl)
                                            {
                                                <img src="@product.Detail1" alt="@product.ProductName" class="product-image-hover">
                                            }
                                        </div>
                                        <div class="product-info">
                                            @if (product.Category != null)
                                            {
                                                <div class="product-category">@product.Category.CategoryName</div>
                                            }
                                            <h4 class="product-name">@product.ProductName</h4>
                                            <div class="product-rating">
                                                <span class="stars">
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star-half-alt"></i>
                                                </span>
                                            </div>
                                            <div class="product-price">
                                                <div class="price-wrapper">
                                                    @if (product.DiscountPrice != null && product.DiscountPrice > 0)
                                                    {
                                                        <span class="price-discount">@product.DiscountPrice.ToString("N0")đ</span>
                                                        <span class="price-original">@product.Price.ToString("N0")đ</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="price-regular">@product.Price.ToString("N0")đ</span>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                        <div class="product-footer">
                                            <a href="@Url.Action("Details", "Product", new { id = product.Id })" class="btn-view-detail">
                                                Xem Chi Tiết <i class="fas fa-arrow-right ms-1"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>

                        <!-- Pagination -->
                        if (ViewBag.TotalPages != null && ViewBag.TotalPages > 1)
                        {
                            <div class="pagination-wrapper">
                                <ul class="pagination-custom">
                                    @if (ViewBag.CurrentPage > 1)
                                    {
                                        <li class="page-item">
                                            <a class="page-link-custom" href="@Url.Action("Index", "Product", new { categoryId = ViewBag.CurrentCategoryId, sortBy = ViewBag.SortBy, page = ViewBag.CurrentPage - 1 })">
                                                <i class="fas fa-chevron-left"></i>
                                            </a>
                                        </li>
                                    }

                                    @for (int i = 1; i <= ViewBag.TotalPages; i++)
                                    {
                                        <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                                            <a class="page-link-custom" href="@Url.Action("Index", "Product", new { categoryId = ViewBag.CurrentCategoryId, sortBy = ViewBag.SortBy, page = i })">@i</a>
                                        </li>
                                    }

                                    @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                                    {
                                        <li class="page-item">
                                            <a class="page-link-custom" href="@Url.Action("Index", "Product", new { categoryId = ViewBag.CurrentCategoryId, sortBy = ViewBag.SortBy, page = ViewBag.CurrentPage + 1 })">
                                                <i class="fas fa-chevron-right"></i>
                                            </a>
                                        </li>
                                    }
                                </ul>
                            </div>
                        }
                    }
                    else
                    {
                        <!-- Empty State -->
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <h3 class="empty-title">Không Tìm Thấy Sản Phẩm</h3>
                            <p class="empty-text">Rất tiếc, chúng tôi không tìm thấy sản phẩm nào phù hợp với bộ lọc của bạn.</p>
                            <a href="@Url.Action("Index", "Product")" class="btn-browse">
                                <i class="fas fa-arrow-left me-2"></i>
                                Xem Tất Cả Sản Phẩm
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</section>

@section scripts {
    <script>
    // Toggle sidebar on mobile
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
    }

    // Wishlist button
    document.querySelectorAll('.action-btn').forEach(btn => {
        if (btn.querySelector('.fa-heart')) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const icon = this.querySelector('i');
                icon.classList.toggle('far');
                icon.classList.toggle('fas');

                if (icon.classList.contains('fas')) {
                    this.style.background = '#e74c3c';
                    this.style.color = 'white';
                }
            });
        }
    });

    // View toggle
    const viewBtns = document.querySelectorAll('.view-btn');
    viewBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            viewBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });

    // Close sidebar when clicking category on mobile
    if (window.innerWidth < 992) {
        document.querySelectorAll('.category-link, .sort-link').forEach(link => {
            link.addEventListener('click', function() {
                setTimeout(() => {
                    toggleSidebar();
                }, 200);
            });
        });
    }

    // Preload Detail1 images for smooth hover effect
    document.querySelectorAll('.product-image-hover').forEach(img => {
        const imageToPreload = new Image();
        imageToPreload.src = img.src;
    });
    </script>
}