@model IEnumerable<FashionStore.Models.Entities.Order>

@{
    ViewBag.Title = "Đơn hàng của tôi";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .orders-section {
        padding: 60px 0;
        background: #f8f9fa;
        min-height: 70vh;
    }

    .breadcrumb-custom {
        background: transparent;
        padding: 0;
        margin-bottom: 30px;
        font-size: 14px;
    }

    .breadcrumb-custom a {
        color: #666;
        text-decoration: none;
        transition: color 0.3s ease;
    }

    .breadcrumb-custom a:hover {
        color: #c9a063;
    }

    .breadcrumb-custom .active {
        color: #1a1a1a;
    }

    /* Page Header */
    .page-header {
        background: white;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .page-title {
        font-family: 'Playfair Display', serif;
        font-size: 36px;
        font-weight: 700;
        color: #1a1a1a;
        margin: 0;
    }

    .orders-count {
        background: linear-gradient(135deg, #c9a063, #d4b072);
        color: white;
        padding: 8px 20px;
        border-radius: 25px;
        font-weight: 600;
        font-size: 14px;
    }

    /* Order Cards */
    .orders-container {
        background: transparent;
    }

    .order-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
    }

    .order-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .order-card.pending {
        border-left-color: #ffc107;
    }

    .order-card.processing {
        border-left-color: #17a2b8;
    }

    .order-card.shipped {
        border-left-color: #007bff;
    }

    .order-card.delivered {
        border-left-color: #28a745;
    }

    .order-card.cancelled {
        border-left-color: #dc3545;
    }

    .order-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
    }

    .order-info {
        flex: 1;
    }

    .order-id {
        font-family: 'Playfair Display', serif;
        font-size: 24px;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 8px;
    }

    .order-id span {
        color: #c9a063;
    }

    .order-date {
        color: #666;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .order-date i {
        color: #c9a063;
    }

    .order-status-badge {
        padding: 8px 20px;
        border-radius: 25px;
        font-weight: 600;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        white-space: nowrap;
    }

    .status-pending {
        background: #fff3cd;
        color: #856404;
    }

    .status-processing {
        background: #d1ecf1;
        color: #0c5460;
    }

    .status-shipped {
        background: #cce5ff;
        color: #004085;
    }

    .status-delivered {
        background: #d4edda;
        color: #155724;
    }

    .status-cancelled {
        background: #f8d7da;
        color: #721c24;
    }

    .order-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .detail-item {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .detail-label {
        color: #999;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
    }

    .detail-value {
        color: #1a1a1a;
        font-size: 16px;
        font-weight: 600;
    }

    .detail-value.price {
        color: #c9a063;
        font-size: 20px;
        font-family: 'Playfair Display', serif;
    }

    .order-actions {
        display: flex;
        gap: 10px;
        padding-top: 20px;
        border-top: 2px solid #f0f0f0;
    }

    .btn-view-detail {
        background: linear-gradient(135deg, #c9a063, #d4b072);
        color: white;
        padding: 12px 25px;
        border-radius: 25px;
        text-decoration: none;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: none;
        cursor: pointer;
        box-shadow: 0 3px 15px rgba(201, 160, 99, 0.3);
    }

    .btn-view-detail:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(201, 160, 99, 0.4);
        color: white;
    }

    .btn-track {
        background: white;
        color: #1a1a1a;
        padding: 12px 25px;
        border-radius: 25px;
        text-decoration: none;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: 2px solid #e5e5e5;
    }

    .btn-track:hover {
        border-color: #c9a063;
        color: #c9a063;
    }

    /* Empty State */
    .empty-orders {
        background: white;
        border-radius: 15px;
        padding: 80px 30px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .empty-icon {
        font-size: 100px;
        color: #e5e5e5;
        margin-bottom: 25px;
    }

    .empty-title {
        font-family: 'Playfair Display', serif;
        font-size: 28px;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 15px;
    }

    .empty-text {
        color: #666;
        font-size: 16px;
        margin-bottom: 30px;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
    }

    .btn-shop-now {
        background: linear-gradient(135deg, #c9a063, #d4b072);
        color: white;
        padding: 15px 40px;
        border-radius: 50px;
        text-decoration: none;
        display: inline-block;
        font-weight: 600;
        font-size: 16px;
        transition: all 0.3s ease;
        box-shadow: 0 5px 20px rgba(201, 160, 99, 0.4);
    }

    .btn-shop-now:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 30px rgba(201, 160, 99, 0.6);
        color: white;
    }

    /* Filter Tabs */
    .filter-tabs {
        background: white;
        border-radius: 15px;
        padding: 15px;
        margin-bottom: 25px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .filter-tab {
        padding: 10px 20px;
        border-radius: 25px;
        background: #f8f9fa;
        color: #666;
        text-decoration: none;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .filter-tab:hover {
        background: #e9ecef;
        color: #1a1a1a;
    }

    .filter-tab.active {
        background: linear-gradient(135deg, #c9a063, #d4b072);
        color: white;
        border-color: #c9a063;
    }

    /* Responsive */
    @media (max-width: 767px) {
        .page-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
        }

        .page-title {
            font-size: 28px;
        }

        .order-header {
            flex-direction: column;
            gap: 15px;
        }

        .order-details {
            grid-template-columns: 1fr;
        }

        .order-actions {
            flex-direction: column;
        }

        .btn-view-detail,
        .btn-track {
            width: 100%;
            justify-content: center;
        }

        .filter-tabs {
            flex-direction: column;
        }

        .filter-tab {
            width: 100%;
            text-align: center;
        }
    }
</style>

<section class="orders-section">
    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb-custom">
            <a href="@Url.Action("Index", "Home")">Trang chủ</a>
            <span class="mx-2">/</span>
            <span class="active">Đơn hàng của tôi</span>
        </nav>

        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Đơn Hàng Của Tôi</h1>
            @if (Model != null && Model.Any())
            {
                <span class="orders-count">@Model.Count() đơn hàng</span>
            }
        </div>

        @if (Model == null || !Model.Any())
        {
            <!-- Empty State -->
            <div class="empty-orders">
                <div class="empty-icon">
                    <i class="fas fa-shopping-bag"></i>
                </div>
                <h2 class="empty-title">Chưa Có Đơn Hàng</h2>
                <p class="empty-text">
                    Bạn chưa có đơn hàng nào. Hãy khám phá các sản phẩm tuyệt vời của chúng tôi và bắt đầu mua sắm ngay!
                </p>
                <a href="@Url.Action("Index", "Product")" class="btn-shop-now">
                    <i class="fas fa-shopping-bag me-2"></i>
                    Mua Sắm Ngay
                </a>
            </div>
        }
        else
        {
            <!-- Filter Tabs -->
            <div class="filter-tabs">
                <a href="@Url.Action("MyOrders", "Order")" class="filter-tab active">
                    <i class="fas fa-list me-2"></i>
                    Tất cả
                </a>
                <a href="@Url.Action("MyOrders", "Order", new { status = "Pending" })" class="filter-tab">
                    <i class="fas fa-clock me-2"></i>
                    Chờ xử lý
                </a>
                <a href="@Url.Action("MyOrders", "Order", new { status = "Processing" })" class="filter-tab">
                    <i class="fas fa-cog me-2"></i>
                    Đang xử lý
                </a>
                <a href="@Url.Action("MyOrders", "Order", new { status = "Shipped" })" class="filter-tab">
                    <i class="fas fa-shipping-fast me-2"></i>
                    Đã giao hàng
                </a>
                <a href="@Url.Action("MyOrders", "Order", new { status = "Delivered" })" class="filter-tab">
                    <i class="fas fa-check-circle me-2"></i>
                    Đã nhận hàng
                </a>
            </div>

            <!-- Orders List -->
            <div class="orders-container">
                @foreach (var order in Model.OrderByDescending(o => o.OrderDate))
                {
                    var statusClass = order.Status?.ToLower() ?? "";
                    var statusBadgeClass = "";
                    var statusText = "";

                    switch (order.Status)
                    {
                        case "Pending":
                            statusClass = "pending";
                            statusBadgeClass = "status-pending";
                            statusText = "Chờ xử lý";
                            break;
                        case "Processing":
                            statusClass = "processing";
                            statusBadgeClass = "status-processing";
                            statusText = "Đang xử lý";
                            break;
                        case "Shipped":
                            statusClass = "shipped";
                            statusBadgeClass = "status-shipped";
                            statusText = "Đã giao hàng";
                            break;
                        case "Delivered":
                            statusClass = "delivered";
                            statusBadgeClass = "status-delivered";
                            statusText = "Đã nhận hàng";
                            break;
                        case "Cancelled":
                            statusClass = "cancelled";
                            statusBadgeClass = "status-cancelled";
                            statusText = "Đã hủy";
                            break;
                        default:
                            statusBadgeClass = "status-pending";
                            statusText = order.Status ?? "Chưa xác định";
                            break;
                    }

                    <div class="order-card @statusClass">
                        <div class="order-header">
                            <div class="order-info">
                                <div class="order-id">
                                    Đơn hàng <span>#@order.Id</span>
                                </div>
                                <div class="order-date">
                                    <i class="far fa-calendar-alt"></i>
                                    <span>@order.OrderDate.ToString("dd/MM/yyyy HH:mm")</span>
                                </div>
                            </div>
                            <span class="order-status-badge @statusBadgeClass">
                                @statusText
                            </span>
                        </div>

                        <div class="order-details">
                            <div class="detail-item">
                                <span class="detail-label">Tổng tiền</span>
                                <span class="detail-value price">@order.TotalAmount.ToString("N0") đ</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Phương thức thanh toán</span>
                                <span class="detail-value">@(!string.IsNullOrEmpty(order.PaymentMethod) ? order.PaymentMethod : "Chưa xác định")</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Địa chỉ giao hàng</span>
                                <span class="detail-value">@(!string.IsNullOrEmpty(order.ShippingAddress) ? (order.ShippingAddress.Length > 50 ? order.ShippingAddress.Substring(0, 50) + "..." : order.ShippingAddress) : "Chưa cập nhật")</span>
                            </div>
                        </div>

                        <div class="order-actions">
                            <a href="@Url.Action("Details", "Order", new { id = order.Id })" class="btn-view-detail">
                                <i class="fas fa-eye"></i>
                                Xem Chi Tiết
                            </a>
                            @if (order.Status == "Shipped" || order.Status == "Delivered")
                            {
                                <a href="@Url.Action("Track", "Order", new { id = order.Id })" class="btn-track">
                                    <i class="fas fa-map-marker-alt"></i>
                                    Theo Dõi Đơn Hàng
                                </a>
                            }
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</section>

@section scripts {
    <script>
        // Highlight active filter tab based on current status
        const urlParams = new URLSearchParams(window.location.search);
        const status = urlParams.get('status');
        
        if (status) {
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.href.includes('status=' + status)) {
                    tab.classList.add('active');
                }
            });
            
            // Make "Tất cả" inactive if a filter is active
            document.querySelectorAll('.filter-tab')[0].classList.remove('active');
        }
    </script>
}
